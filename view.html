<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <style>
    img { align: middle; display: block; min-height: 50px; }
    nav {
      position: fixed;
      left: 5px;
      top: 5px;
      bottom: 5px;
    }
    nav > div {
      overflow-y: scroll;
      overflow-x: auto;
      max-height: 95%;
      display: none;
    }
    </style>
    <script type="module">
    const images = await fetch("/images").then((res) => {
      if (res.ok) {
	return res.json()
      }
    })

    const main = document.getElementsByTagName("center")[0]
    const nav = document.getElementsByTagName("nav")[0].lastElementChild

    images.forEach((file, idx) => {
      const img = document.createElement("img")
      img.setAttribute("src", file)
      img.setAttribute("id", file)
      if (idx == 10) {
	//sleep(5)
      } else if (idx > 5) {
	img.setAttribute("loading", "lazy")
      }
      main.appendChild(img)
    })

    const grouped = Object.groupBy(images, (img) => img.split("/")[0])
    for (let sec in grouped) {
      const link = document.createElement("a")
      link.setAttribute("href", "#"+grouped[sec][0])
      link.innerText = sec
      const div = document.createElement("div")
      div.appendChild(link)
      nav.appendChild(div)
    }
    document.getElementsByTagName("button")[0].addEventListener(
      "click",
      () => {
	nav.style.display = nav.style.display == "none" ? "block" : "none"
      }
    )
    </script>
    <title>Read manga</title>
  </head>
  <body>
    <noscript>You need javascript to view this page.</noscript>
    <nav>
      <button>Menu</button>
      <div></div>
    </nav>
    <center></center>
  </body>
</html>
